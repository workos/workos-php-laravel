#!/bin/bash

KEY="composer-laravel-${1}-$(checksum composer.json)"

echo "Get that cache"
cache restore $KEY

echo -n "Setting desired Laravel version to "
case ${1} in
  "5")
    echo "5...ish"
    laravel_version="^5.8"
    ;;

  "6")
    echo "6...ish"
    laravel_version="^6.18"
    ;;

  "7")
    echo "7...ish"
    laravel_version="^7.5"
    ;;
  
  "8")
    echo "8"
    laravel_version="^8.76.2"
    ;;
    
  "9")
    echo "9"
    laravel_version="^9.52.7"
    echo "install composer"
    php composer-setup.php --install-dir=bin --filename=composer
    mv composer.phar /usr/local/bin/composer
    ;;
  
  # "10")
  #   echo "10"
  #   laravel_version="^10.9.0"
  #   ;;

  *)
    printf "\nError: Specify either 5, 6, or 7 for Laravel version\n"
    exit 1
    ;;
esac

echo "Install desired Laravel version then update everything"
composer require laravel/framework=${laravel_version}
composer u

echo "Attempt to store cache in case of an initial miss"
cache store $KEY ./vendor

